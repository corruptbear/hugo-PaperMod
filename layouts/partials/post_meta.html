{{- $scratch := newScratch }}

{{- if not .Date.IsZero -}}
{{- $scratch.Add "meta" (slice (printf "<span title='%s'>%s</span>" (.Date) (.Date | time.Format (default "January 2, 2006" site.Params.DateFormat)))) }}
{{- end }}

{{- if (.Param "ShowReadingTime") -}}
{{- $scratch.Add "meta" (slice (i18n "read_time" .ReadingTime | default (printf "%d min" .ReadingTime))) }}
{{- end }}

{{- if (.Param "ShowWordCount") -}}
{{- $scratch.Add "meta" (slice (i18n "words" .WordCount | default (printf "%d words" .WordCount))) }}
{{- end }}

{{- with (partial "author.html" .) }}
{{- $scratch.Add "meta" (slice .) }}
{{- end }}



{{- $url := "https://comments.blog.konomama.dev/count" -}}
{{- $postPermalink := .Page.RelPermalink -}}

{{- $body := printf "[\"%s\"]" $postPermalink | safeJS -}}

{{- $options := dict
    "method" "POST"
    "headers" (dict "Content-Type" "application/json" "Cache-Control" "no-cache")
    "body" $body
}} 

{{- $response := resources.GetRemote $url $options -}}

{{- with $response -}}
  {{- if .Err -}}
    <p>Error fetching remote resource: {{ .Err }}</p>
  {{- else -}}
    {{- $content := .Content -}}
    
    {{- /* Remove brackets and extract number */ -}}
    {{- $numberStr := $content | replaceRE "^\\[\"?([0-9]+)\"?\\]?$" "$1" -}}
    {{- $number := $numberStr | int -}}
    
    {{- if $number -}}
      {{- $scratch.Add "meta" (printf "%d ðŸ’¬" $number) }}

    {{- end -}}
  {{- end -}}
{{- else -}}
  <p>Unable to get remote resource {{ $url }}</p>
{{- end -}}






{{- with ($scratch.Get "meta") }}
{{- delimit . "&nbsp;Â·&nbsp;" | safeHTML -}}
{{- end -}}
